---
title: 自动对焦专讲
toc: true
date: 2020-01-01 00:00:01
tags: Camera
---

# 自动对焦的工作原理

------

- AF的对焦原理是通过电磁感应使镜头移动，改变焦距完成自动对焦。

![自动对焦](%E8%87%AA%E5%8A%A8%E5%AF%B9%E7%84%A6/image-20201210112852132-1607571037074.png)

- VCM 实现对焦原理

  进入自动对焦（AF）模式后，Driver IC输出电流从0到最大值，使得镜头从原始位置移动到最大位置，此时ISP通过sensor成像，计算每一副图片的MTF（Modulation transfer function）值，从而在这条MTF曲线中找到最大值（**即图像最清晰的点**），并通过算法，得到这个点对应的电流大小，再一次指示Driver IC提供给音圈这个电流，而使镜头稳定在这个成像面，达到自动变焦效果。

  AF的目的是确定实现对焦的最佳镜头位置，并触发VCM将镜头移动到该位置。一般来说，AF过程如下：

  1. AF算法同时检测硬件和软件统计数据，以确定是否存在场景变化。
  2. 如果算法检测到场景变化，则算法触发搜索。
  3. 算法的粗搜索确定下一个镜头位置。
  4. VCM逐渐将镜头移动到下一个位置。
  5. 精搜索找到最终的镜头位置。
  6. VCM将镜头移动到最终位置。

  AF对焦方式分为：对比度/反差对焦(CAF)、相位对焦(PDAF)、激光对焦(TOFAF)，每种算法都实现了检测和搜索功能。

# 反差对焦  CAF

------

对比度对焦，也叫反差对焦。反差对焦是目前普及率最高，使用最广泛，成本相对较低的自动对焦技术。对焦的过程就是通过移动镜片来使对焦区域的图像达到最清晰的过程，所以对焦成功以后，直观的感受就是焦点的清晰度最高，而焦点以外的区域则表现为相对模糊状态。因为**反差对焦的工作方式是进行对比度检测**，因此相机镜片必须要前后移动完整记录所有的图像信息，然后计算出对比度最高的位置，才能最终完成对焦，所以反差对焦的一个主要缺点就是耗费的时间较长。

![反差对焦](%E8%87%AA%E5%8A%A8%E5%AF%B9%E7%84%A6/20200802010227222.png)

# 相位差对焦 PDAF

------

相位对焦，是在像素传感器上拿出左右相对的成对像素点，分别对场景中的物体进行进光量等信息的检测，通过比对左右两侧的相关值情况，便会迅速找出准确的对焦点，之后镜间马达便会一次性将镜片推动到相应位置完成对焦。相位对焦也并不是十分完美，它对光线的要求就比较高，在弱光拍摄环境下，相位对焦就无能为力了。

![相位差对焦](%E8%87%AA%E5%8A%A8%E5%AF%B9%E7%84%A6/image-20201210114809533.png)

物体的某一个点会从各个方向发出光线通过镜片成像到snesor上面去，只有当不同方向的光线成像落到sensor的同一个位置的时候才是像差最小的时候：

上图中，紫色是物体的一个点，黄色是sensor即成像面，1号蓝色镜片离sensor太远，上下两条光线所成的像没有重合；2号蓝色镜片和snesor的距离合适，上下两条光线所成的像重合了没有相差，所以对焦成功；3、4号蓝色镜片离sensor的距离太近了，上下两条光线所成的像没有重合，但是和1号不同的是相差的方向是不一样的。

通过**计算相位差并将其转换为defocus(离焦)值**，以指示实现聚焦所需的镜头移动的大小和方向。正defocus值意味着运动由近到远，负defocus值意味着运动从远到近。当defocus值接近零时，表示目标处于焦点。